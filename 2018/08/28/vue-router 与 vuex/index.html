<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vue-router与Vuex · vkcyan</title><meta name="description" content="Vue-router与Vuex - vkcyan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="vkcyan"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">简历</a></li><li class="nav-list-item"><a href="https://github.com/vkcyan" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vue-router与Vuex</h1><div class="post-info">Aug 28, 2018</div><div class="post-content"><h1 id="Vue-router与Vuex特性总结"><a href="#Vue-router与Vuex特性总结" class="headerlink" title="Vue-router与Vuex特性总结"></a>Vue-router与Vuex特性总结</h1><p>一直以来,写vue项目一直都是使用cli去帮我们生成,一切都帮我们做好了,回头自己搭建项目,发现很多配置都是很麻烦的,也很有价值,本文章就记录自己搭建的vue</p>
<p>项目的vue-rouer以及vuex应用</p>
<h2 id="Vue-router"><a href="#Vue-router" class="headerlink" title="Vue-router"></a>Vue-router</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vue-router -S    //s为生成环境</span><br></pre></td></tr></table></figure>
<p>安装完成后,在src后面新建config文件夹</p>
<p>里面新建rouer.js以及routes.js</p>
<p>在routes.js里面写路由配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Todo <span class="keyword">from</span> <span class="string">'../views/todo/todo.vue'</span></span><br><span class="line"><span class="keyword">import</span> Login <span class="keyword">from</span> <span class="string">'../views/login/login.vue'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/app'</span>,</span><br><span class="line">    component: Todo</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/login'</span>,</span><br><span class="line">    ccomponent: Login</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在rouer.js里面写项目配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Router <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'./routes'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">    routes</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再index.js里面导入vuerouter</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./app.vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./assets/style/global.styl'</span></span><br><span class="line"><span class="keyword">import</span> createRouter <span class="keyword">from</span> <span class="string">'./config/router'</span></span><br><span class="line"><span class="keyword">const</span> root = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(root)</span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"><span class="keyword">const</span> router = createRouter()</span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  router,</span><br><span class="line">  render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App)</span><br><span class="line">&#125;).$mount(root)</span><br></pre></td></tr></table></figure>
<p>到这一步看似完成了,但是在app.vue里面还没有进行路由的显示,这时候无论我们怎么跳转都不会有反应</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"cover"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">headers</span>&gt;</span><span class="tag">&lt;/<span class="name">headers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footers</span>&gt;</span><span class="tag">&lt;/<span class="name">footers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置路由重定向</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    redirect: <span class="string">'/app'</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>配置路由为history模式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return new Router(&#123;</span><br><span class="line">    routes,</span><br><span class="line">    mode: &apos;history&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里要注意 也是我遇到的bug,设置为histroy后,跳转路由出现了Error,</p>
<p>貌似是webpack-dev-server的问题,修改一下配置文件</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> devServer = &#123;</span><br><span class="line">  port: <span class="string">'8000'</span>,</span><br><span class="line">  host: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">  overlay: &#123; <span class="comment">// 配置错误</span></span><br><span class="line">    errors: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  hot: <span class="literal">true</span>,</span><br><span class="line">  historyApiFallback: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就完成了基本的路由配置</p>
<h3 id="基本参数"><a href="#基本参数" class="headerlink" title="基本参数"></a>基本参数</h3><p>base: 指定路由前缀,但是不通过前缀也可以访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return new Router(&#123;</span><br><span class="line">    routes,</span><br><span class="line">    mode: &apos;history&apos;,</span><br><span class="line">    base: &apos;/base/&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://router.vuejs.org/zh/api/#active-class" target="_blank" rel="noopener">linkActiveClass</a>: 全局配置 <code>&lt;router-link&gt;</code> 的默认“激活 class 类名” </p>
<p><a href="https://router.vuejs.org/zh/api/#exact-active-class" target="_blank" rel="noopener">linkExactActiveClass</a>: 全局配置 <code>&lt;router-link&gt;</code> 精确激活的默认的 class。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return new Router(&#123;</span><br><span class="line">    routes,</span><br><span class="line">    mode: &apos;history&apos;,</span><br><span class="line">    linkActiveClass: &apos;active-link&apos;,</span><br><span class="line">    linkExactActiveClass: &apos;exact-active-link&apos;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vue-router 精准匹配到的路径会添加linkExactActiveClass</p>
<p>vue-rourer 匹配到了后就加上linkActiveClass</p>
<p>scrollBehavior 滚动行为</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Router(&#123;</span><br><span class="line">    routes,</span><br><span class="line">    mode: <span class="string">'history'</span>,</span><br><span class="line">    linkActiveClass: <span class="string">'active-link'</span>,</span><br><span class="line">    linkExactActiveClass: <span class="string">'exact-active-link'</span>,</span><br><span class="line">    scrollBehavior (to, <span class="keyword">from</span>, savedPosition) &#123;</span><br><span class="line">      <span class="comment">// to是前往的路由</span></span><br><span class="line">      <span class="comment">// from就是之前的路由</span></span><br><span class="line">      <span class="comment">// savedPosition记录滚动条1的位置</span></span><br><span class="line">      <span class="keyword">if</span> (savedPosition) &#123;</span><br><span class="line">        <span class="keyword">return</span> savedPosition</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>parseQuery / stringifyQuery</p>
<p>提供自定义查询字符串的解析/反解析函数。 </p>
<p><a href="fallback">fallback </a>  当浏览器不支持 <code>history.pushState</code> 控制路由是否应该回退到 <code>hash</code> 模式 </p>
<h3 id="路由的跳转"><a href="#路由的跳转" class="headerlink" title="路由的跳转"></a>路由的跳转</h3><p>我们可以给路由起名字,让他可以在页面里面通过名字进行跳转</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/app'</span>,</span><br><span class="line">    component: Todo,</span><br><span class="line">    name: <span class="string">'app'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  app.vue</span><br><span class="line">  &lt;router-link :to=<span class="string">"&#123;name: 'app'&#125;"</span>&gt; app &lt;<span class="regexp">/router-link&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们可以将一些页面的配置放在meta里面</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">meta: &#123;</span><br><span class="line">      title: <span class="string">'主页  '</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>配置子路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">children: [</span><br><span class="line">      &#123;</span><br><span class="line">        path: &apos;test&apos;,</span><br><span class="line">        component: Login</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<p>注意一点配置子路由的时候在子页面也要加上 \<router-view>否则也会没有效果</router-view></p>
<h3 id="传参"><a href="#传参" class="headerlink" title="传参"></a>传参</h3><blockquote>
<p>巨坑,webpack真的是巨坑,自动匹配路由生成js文件,导致我访问二级目录或者多级目录就404,谷歌啊,看文档啊搞一下午才搞定,解决方案</p>
</blockquote>
<p>在输出目录加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publicPath: &apos;/&apos;</span><br></pre></td></tr></table></figure>
<p>在devServer加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">publicPath: &apos;/&apos;</span><br></pre></td></tr></table></figure>
<p>文档讲的模模糊糊,或者本人理解能力有限,虽然最后解决了,但是这还有运气成分在里面</p>
<p>我们可以在路由里面指定一个参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/app/:id'</span>,</span><br><span class="line">    component: Todo,</span><br><span class="line">    name: <span class="string">'app'</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">'主页'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>看看$router对面里面可以获取到什么</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;router-link to=<span class="string">"/app/123"</span>&gt; app &lt;<span class="regexp">/router-link&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">.....</span></span><br><span class="line"><span class="regexp"> mounted () &#123;</span></span><br><span class="line"><span class="regexp">    console.log(this.$route)</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="http://on7r0tqgu.bkt.clouddn.com/Frl9N788oDn5Hajq17INw_YtWl-i.png" alt=""></p>
<p>我们可以路由里面进行进行props传递</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: &apos;/app/:id&apos;,</span><br><span class="line">    props: true, // 会传给组件</span><br><span class="line">    component: Todo,</span><br><span class="line">    name: &apos;app&apos;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: &apos;主页&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>我们在todo里面查看id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">props: [&apos;id&apos;],</span><br><span class="line">  mounted () &#123;</span><br><span class="line">    console.log(this.id)</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>可以在props里面做很多操作,这样做有利与解耦</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   path: <span class="string">'/app/:id'</span>,</span><br><span class="line">   props: <span class="function">(<span class="params">router</span>) =&gt;</span> (&#123; <span class="attr">id</span>: router.query.d &#125;),  <span class="comment">//获取参数d</span></span><br><span class="line">   <span class="comment">// props: &#123;</span></span><br><span class="line">   <span class="comment">//   id: 123 // 可以直接给值</span></span><br><span class="line">   <span class="comment">// &#125;,</span></span><br><span class="line">   <span class="comment">// props: true, // 会传给组件</span></span><br><span class="line">   component: Todo,</span><br><span class="line">   name: <span class="string">'app'</span>,</span><br><span class="line">   meta: &#123;</span><br><span class="line">     title: <span class="string">'主页'</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="命名视图"><a href="#命名视图" class="headerlink" title="命名视图"></a>命名视图</h3><p>给路由一个名字,在components里面定义路由下,根据名字显示组件</p>
<p>app.vue</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;transition name=<span class="string">"fade"</span>&gt;</span><br><span class="line">      &lt;router-view /&gt;</span><br><span class="line">    &lt;<span class="regexp">/transition&gt;</span></span><br><span class="line"><span class="regexp">    &lt;footers&gt;&lt;/</span>footers&gt;</span><br><span class="line">    &lt;router-view name=<span class="string">"a"</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>我们创建两个router-view</p>
<p>在router配置里面配置不一样的名字的组件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   path: <span class="string">'/app'</span>,</span><br><span class="line">   components: &#123;</span><br><span class="line">     <span class="keyword">default</span>: Todo,</span><br><span class="line">     a: Login</span><br><span class="line">   &#125;,</span><br><span class="line">   name: <span class="string">'app'</span>,</span><br><span class="line">   meta: &#123;</span><br><span class="line">     title: <span class="string">'主页'</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">   path: <span class="string">'/login'</span>,</span><br><span class="line">   components: &#123;</span><br><span class="line">     <span class="keyword">default</span>: Login,</span><br><span class="line">     a: Todo</span><br><span class="line">   &#125;,</span><br><span class="line">   name: <span class="string">'login'</span></span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p>这样会有一种互换的效果因为路由名字不一样</p>
<h3 id="导航守卫"><a href="#导航守卫" class="headerlink" title="导航守卫"></a>导航守卫</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">  console.log(&apos;我是路由守卫beforeEach&apos;)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line">router.beforeResolve((to, from, next) =&gt; &#123;</span><br><span class="line">  console.log(&apos;我是路由守卫beforeResolve&apos;)</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">router.afterEach((to, from) =&gt; &#123;</span><br><span class="line">  console.log(&apos;我是路由守卫afterEach&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="C:\Users\spring\AppData\Local\Temp\1535631559145.png" alt=""></p>
<p>beforeEach可以做验证,必须登录</p>
<p>比如只让login走其他的都不允许路由跳转</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (to.fullPath === <span class="string">'/login'</span>) &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>比如强制路由跳转</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (to.fullPath === &apos;/app&apos;) &#123;</span><br><span class="line">    next(&apos;/login&apos;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>或者进行路由的控制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">  console.log(&apos;我是路由守卫beforeEach&apos;, to.fullPath)</span><br><span class="line">  if (to.fullPath !== &apos;/app&apos;) &#123;</span><br><span class="line">    next(&#123; name: &apos;app&apos; &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>也可以配置单路由的路由守卫</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    path: <span class="string">'/app'</span>,</span><br><span class="line">    component: Todo,</span><br><span class="line">    name: <span class="string">'app'</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">'主页'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    beforeEnter (to, <span class="keyword">from</span>, next) &#123; <span class="comment">// 在进入app就会触发 </span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'app start'</span>)</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>在组件里面依旧可以创建钩子</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'todo的守卫开始了'</span>)</span><br><span class="line">    next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'获取data数据 filter'</span>, vm.filter)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteUpdate (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'todo的守卫更新了'</span>)</span><br><span class="line">    next()</span><br><span class="line">  &#125;,</span><br><span class="line">  beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'todo的守卫离开了'</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.confirm(<span class="string">'真的真的退出吗'</span>)) &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p><img src="http://on7r0tqgu.bkt.clouddn.com/FrT0q74ftI90YZaJF4A9cqnHKbuC.png" alt=""></p>
<p>通过路由的变化去触发更新的路由钩子</p>
<p><img src="http://on7r0tqgu.bkt.clouddn.com/FoUy3Y6zHgOyMGrhmuCMNHn4nwOS.png" alt=""></p>
<p>还可以在路由里面对数据进行控制,但是注意不了直接获取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteEnter (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">'todo的守卫开始了'</span>)</span><br><span class="line">   next(<span class="function"><span class="params">vm</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'获取data数据 filter'</span>, vm.filter)</span><br><span class="line">   &#125;)</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
<p>或者对填写表单,用户离开时候给一个提示</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">beforeRouteLeave (to, <span class="keyword">from</span>, next) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'todo的守卫离开了'</span>)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.confirm(<span class="string">'真的真的退出吗'</span>)) &#123;</span><br><span class="line">      next()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p>异步组件</p>
<p>使用异步组件需要一个插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-plugin-syntax-dynamic-import -D</span><br></pre></td></tr></table></figure>
<p>修改一下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/'</span>,</span><br><span class="line">    redirect: <span class="string">'/app'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/app/:id'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../views/todo/todo.vue'</span>),</span><br><span class="line">    name: <span class="string">'app'</span>,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      title: <span class="string">'主页'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">'/login'</span>,</span><br><span class="line">    component: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'../views/login/login.vue'</span>),</span><br><span class="line">    name: <span class="string">'login'</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>现在就是异步加载组件了,我们的组件会在加载的时候import进来</p>
<p><img src="http://on7r0tqgu.bkt.clouddn.com/FmMd7yoEQzFcK_fEwjdgXqw0nYBc.png" alt=""></p>
<h2 id="VueX"><a href="#VueX" class="headerlink" title="VueX"></a>VueX</h2><blockquote>
<p>因为没有接触用它vuex比较多的项目,导致vuex看过就忘了,这次写全一点</p>
</blockquote>
<p>安装Vuex</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install vuex -S</span><br></pre></td></tr></table></figure>
<p>新建文件夹store&gt;store.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">      updateCount (state, num) &#123;</span><br><span class="line">        state.count = num</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在index.js里面引入</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./app.vue'</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./assets/style/global.styl'</span></span><br><span class="line"><span class="keyword">import</span> createRouter <span class="keyword">from</span> <span class="string">'./config/router'</span></span><br><span class="line"><span class="keyword">import</span> createstore <span class="keyword">from</span> <span class="string">'./store/store'</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter()</span><br><span class="line"><span class="keyword">const</span> store = createstore()</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#root'</span>,</span><br><span class="line">  router,</span><br><span class="line">  store,</span><br><span class="line">  render: <span class="function">(<span class="params">h</span>) =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="mutations"><a href="#mutations" class="headerlink" title="mutations"></a>mutations</h3><p>mutations里面的方法可以通过commit来进行使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mounted () &#123;</span><br><span class="line">    console.log(this.$store)</span><br><span class="line">    let i = 1</span><br><span class="line">    setInterval(() =&gt; &#123;</span><br><span class="line">      this.$store.commit(&apos;updateCount&apos;, i++)</span><br><span class="line">    &#125;, 2000)</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    count () &#123;</span><br><span class="line">      return this.$store.state.count</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>在应对大型的数据的时候,我么你的vuex尽可能的分模块,</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> defaultState <span class="keyword">from</span> <span class="string">'./state/state'</span></span><br><span class="line"><span class="keyword">import</span> defauleMutations <span class="keyword">from</span> <span class="string">'./mutations/mutations'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    state: defaultState,</span><br><span class="line">    mutations: defauleMutations</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="getters"><a href="#getters" class="headerlink" title="getters"></a>getters</h3><p>getters可以对data数据进行二次处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; <span class="comment">// 可以理解为computed</span></span><br><span class="line">  fullName (state) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`姓名:<span class="subst">$&#123;state.name&#125;</span>,年龄:<span class="subst">$&#123;state.count&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">computed: &#123;</span><br><span class="line">    count () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.count</span><br><span class="line">    &#125;,</span><br><span class="line">    fullName () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.getters.fullName</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用es7 甚至es8的语法</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-preset-stage-1 -D</span><br></pre></td></tr></table></figure>
<p><code>this.$store.state.count</code>这样的写法并不是很好,官方提供了一个辅助函数<code>mapState</code>,当一个组件需要获取多个状态时候，将这些状态都声明为计算属性会有些重复和冗余。为了解决这个问题，我们可以使用 <code>mapState</code> 辅助函数帮助我们生成计算属性 </p>
<h5 id="mapState"><a href="#mapState" class="headerlink" title="mapState"></a>mapState</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapState([<span class="string">'count'</span>]),</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>还可以是对象或者函数的写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...mapState(&#123;</span><br><span class="line">     counter: &apos;count&apos;</span><br><span class="line">   &#125;),</span><br></pre></td></tr></table></figure>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">...mapState(&#123;</span><br><span class="line">      counter: (state) =&gt; &#123;</span><br><span class="line">        return state.count</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;),</span><br></pre></td></tr></table></figure>
<h5 id="mapGetters"><a href="#mapGetters" class="headerlink" title="mapGetters"></a>mapGetters</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">...mapGetters([<span class="string">'fullName'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">//..............</span></span><br><span class="line"></span><br><span class="line">...mapGetters(&#123;</span><br><span class="line">      fullName: <span class="string">'fullName'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="mutations-1"><a href="#mutations-1" class="headerlink" title="mutations"></a>mutations</h3><p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation。Vuex 中的 mutation 非常类似于事件：每个 mutation 都有一个字符串的 <strong>事件类型 (type)</strong> 和 一个 <strong>回调函数 (handler)</strong>。</p>
<p>假如要传递多个参数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">updateCount (state, &#123; num, num2 &#125;) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(num2)</span><br><span class="line">    state.count = num</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>传一个对象,返回通过解构去得到参数</p>
<p>当然数据可以直接修改,但是不推荐这么做</p>
<p>我们在开发环境可以使用strict去限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const isDev = process.env.NODE_ENV === &apos;development&apos;</span><br><span class="line"></span><br><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return new Vuex.Store(&#123;</span><br><span class="line">    strict: isDev,</span><br><span class="line">    state: defaultState,</span><br><span class="line">    mutations,</span><br><span class="line">    getters</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时候我么在去直接修改store里面的数值,vue就发出警告</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$store.state.count = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Vue warn]: Error in callback for watcher &quot;function () &#123; return this._data.$$state &#125;&quot;: &quot;Error: [vuex] Do not mutate vuex store state outside mutation handlers.&quot;</span><br></pre></td></tr></table></figure>
<h3 id="actions"><a href="#actions" class="headerlink" title="actions"></a>actions</h3><p>这就是异步的mutations,但是我们可以再actions里面处理mutations,使用promise来进行控制等等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  updateCountSync (store, data) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      store.commit(<span class="string">'updateCount'</span>, data.num)</span><br><span class="line">    &#125;, data.time)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// .....</span></span><br><span class="line"><span class="keyword">this</span>.updateCountSync(&#123;</span><br><span class="line">   time: <span class="number">2000</span>,</span><br><span class="line">   num: <span class="number">5</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="mapActions-mapMutations"><a href="#mapActions-mapMutations" class="headerlink" title="mapActions, mapMutations"></a>mapActions, mapMutations</h3><blockquote>
<p> 组件绑定的辅助函数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; mapState, mapGetters, mapActions, mapMutations &#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="comment">// .....</span></span><br><span class="line"> methods: &#123;</span><br><span class="line">    ...mapActions([<span class="string">'updateCountSync'</span>]),</span><br><span class="line">    ...mapMutations([<span class="string">'updateCount'</span>])</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// .......</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">  <span class="keyword">this</span>.updateCountSync(&#123;</span><br><span class="line">    time: <span class="number">2000</span>,</span><br><span class="line">    num: <span class="number">5</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">let</span> i = <span class="number">1</span></span><br><span class="line">  setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  	<span class="keyword">this</span>.updateCount(i++)</span><br><span class="line">  &#125;, <span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Vuex的模块化"><a href="#Vuex的模块化" class="headerlink" title="Vuex的模块化"></a>Vuex的模块化</h2><p>当业务变的非常庞大的时候,业务的所有状态都会集中在一个对象里面,当业务变动非常复杂的时候,vue允许我们将store分割成模块(module),每个模块都有他的state、mutation、action、getter </p>
<h3 id="state"><a href="#state" class="headerlink" title="state"></a>state</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">export default () =&gt; &#123;</span><br><span class="line">  return new Vuex.Store(&#123;</span><br><span class="line">    strict: isDev,</span><br><span class="line">    state: state,</span><br><span class="line">    mutations,</span><br><span class="line">    getters,</span><br><span class="line">    actions,</span><br><span class="line">    modules: &#123;</span><br><span class="line">      a: &#123;</span><br><span class="line">        state: &#123;</span><br><span class="line">          text: 1</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      b: &#123;</span><br><span class="line">        state: &#123;</span><br><span class="line">          text: 2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">testA () &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.$store.state.b.text</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...mapState(&#123;</span><br><span class="line">     textA: state =&gt; state.a.text</span><br><span class="line">   &#125;),</span><br></pre></td></tr></table></figure>
<h3 id="mutations-2"><a href="#mutations-2" class="headerlink" title="mutations"></a>mutations</h3><blockquote>
<p>用法和全局mutations一样,vue会自动给我们挂载到全局</p>
<p>当然可以设置单独的命名空间</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">a: &#123;</span><br><span class="line">        namespaced: <span class="literal">true</span>, <span class="comment">// 设置单独的命名空间</span></span><br><span class="line">        state: &#123;</span><br><span class="line">          text: <span class="number">1</span></span><br><span class="line">        &#125;,</span><br><span class="line">        mutations: &#123;</span><br><span class="line">          updateText (state, text) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(state)</span><br><span class="line">            state.text = text</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line"> <span class="comment">// .........</span></span><br><span class="line">methods: &#123;</span><br><span class="line"> ...mapMutations([<span class="string">'updateCount'</span>, <span class="string">'a/updateText'</span>])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mounted () &#123;</span><br><span class="line">  <span class="keyword">this</span>[<span class="string">'a/updateText'</span>](<span class="number">123</span>)  <span class="comment">//调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="getters-1"><a href="#getters-1" class="headerlink" title="getters"></a>getters</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">          textPlus (state) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`我是<span class="subst">$&#123;state.text&#125;</span>`</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//...........</span></span><br><span class="line">computed: &#123;</span><br><span class="line">  ...mapGetters([<span class="string">'fullName'</span>, <span class="string">'a/textPlus'</span>])</span><br><span class="line">&#125;</span><br><span class="line">mounted () &#123;</span><br><span class="line">  <span class="keyword">this</span>[<span class="string">'a/updateText'</span>](<span class="number">123</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样写没办法写在模板里面,我们可以改一下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...mapGetters(&#123;</span><br><span class="line">    &apos;fullName&apos;: &apos;fullName&apos;,</span><br><span class="line">    &apos;textPlus&apos;: &apos;a/textPlus&apos;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>这样在模板里面就可以 使用了</p>
<h3 id="在局部vuex里面可以获取全局的vuex的state"><a href="#在局部vuex里面可以获取全局的vuex的state" class="headerlink" title="在局部vuex里面可以获取全局的vuex的state"></a>在局部vuex里面可以获取全局的vuex的state</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">getters: &#123;</span><br><span class="line">         textPlus (state, getters, rootState) &#123; <span class="comment">// 第二参数是所有getters的方法 第三参数是全局的state</span></span><br><span class="line">           <span class="keyword">return</span> <span class="string">`我是<span class="subst">$&#123;state.text&#125;</span>,全局state<span class="subst">$&#123;rootState.count&#125;</span>`</span></span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>既然可以获取全局,必然可以获取你想要的模块的state</p>
<h3 id="actions-1"><a href="#actions-1" class="headerlink" title="actions"></a>actions</h3><p>关于actions基本功能和上面类似,但是在分模块上面存在全局 以及模块将的数据调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">actions: &#123;</span><br><span class="line">        add (&#123; state, commit, rootState &#125;) &#123;</span><br><span class="line">          <span class="comment">// commit('updateText', 20)</span></span><br><span class="line">          commit(<span class="string">'updateCount'</span>, <span class="number">100</span>, &#123;<span class="attr">root</span>: <span class="literal">true</span>&#125;) <span class="comment">// 加上&#123;root: true&#125;就是调用全局的vex的mutations</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>调用上面个mutations一样的,以为呢这里加入了命名空间,所以调用要加前缀</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">    ...mapActions([<span class="string">'updateCountSync'</span>, <span class="string">'a/add'</span>]),</span><br><span class="line">    ...mapMutations([<span class="string">'updateCount'</span>, <span class="string">'a/updateText'</span>])</span><br><span class="line">  &#125;</span><br><span class="line">mounted () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.$store)</span><br><span class="line">    <span class="comment">// this.updateCountSync(&#123;</span></span><br><span class="line">    <span class="comment">//   time: 2000,</span></span><br><span class="line">    <span class="comment">//   num: 5</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">1</span></span><br><span class="line">    setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.updateCount(i++)</span><br><span class="line">    &#125;, <span class="number">2000</span>)</span><br><span class="line">    <span class="keyword">this</span>[<span class="string">'a/add'</span>]()</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<h3 id="动态注册模块"><a href="#动态注册模块" class="headerlink" title="动态注册模块"></a>动态注册模块</h3><p>模块动态注册功能使得其他 Vue 插件可以通过在 store 中附加新模块的方式来使用 Vuex 管理状态。例如，<a href="https://github.com/vuejs/vuex-router-sync" target="_blank" rel="noopener"><code>vuex-router-sync</code></a> 插件就是通过动态注册模块将 vue-router 和 vuex 结合在一起，实现应用的路由状态管理。 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">store.registerModule(<span class="string">'c'</span>, &#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    text: <span class="number">33232323</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="vuex的热重载"><a href="#vuex的热重载" class="headerlink" title="vuex的热重载"></a>vuex的热重载</h2><p>关于vuex的来热重载,官方给了详细的配置<a href="https://vuex.vuejs.org/zh/guide/hot-reload.html#%E7%83%AD%E9%87%8D%E8%BD%BD" target="_blank" rel="noopener">热重载</a></p>
<p>这里根据我自己的环境来配置热重载</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">'./state/state'</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations/mutations'</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters/getters'</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'./actions/actions'</span></span><br><span class="line"><span class="keyword">const</span> isDev = process.env.NODE_ENV === <span class="string">'development'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">    strict: isDev,</span><br><span class="line">    state: state,</span><br><span class="line">    mutations, <span class="comment">// 同步方法</span></span><br><span class="line">    getters, <span class="comment">// 处理state</span></span><br><span class="line">    actions <span class="comment">// 异步方法</span></span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept([</span><br><span class="line">      <span class="string">'./state/state'</span>,</span><br><span class="line">      <span class="string">'./mutations/mutations'</span>,</span><br><span class="line">      <span class="string">'./getters/getters'</span>,</span><br><span class="line">      <span class="string">'./actions/actions'</span></span><br><span class="line">    ], () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> newState = <span class="built_in">require</span>(<span class="string">'./state/state'</span>).default</span><br><span class="line">      <span class="keyword">const</span> newMutations = <span class="built_in">require</span>(<span class="string">'./mutations/mutations'</span>).default</span><br><span class="line">      <span class="keyword">const</span> newGetters = <span class="built_in">require</span>(<span class="string">'./getters/getters'</span>).default</span><br><span class="line">      <span class="keyword">const</span> newActions = <span class="built_in">require</span>(<span class="string">'./actions/actions'</span>).default</span><br><span class="line"></span><br><span class="line">      store.hotUpdate(&#123;</span><br><span class="line">        state: newState,</span><br><span class="line">        mutations: newMutations,</span><br><span class="line">        getters: newGetters,</span><br><span class="line">        actions: newActions</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> store</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Vuex的其他API"><a href="#Vuex的其他API" class="headerlink" title="Vuex的其他API"></a>Vuex的其他API</h2><p>store.watch</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">store.watch(</span><br><span class="line">  (state) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> state.count</span><br><span class="line">  &#125;,</span><br><span class="line">  (newCount) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'state的count更新了'</span>, newCount)</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>只要state,count发生变化,就会执行回调</p>
<p>要停止侦听，调用此方法返回的函数即可停止侦听</p>
<p>store.subscribe   订阅 store 的 mutation </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">store.subscribe(<span class="function">(<span class="params">mutations, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(mutations.type) <span class="comment">// 传入的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(mutations.payload) <span class="comment">// 接受的参数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>只要mutations被调用,就会触发这个</p>
<p>store.subscribeAction 订阅 store 的 action</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">store.subscribeAction(<span class="function">(<span class="params">action, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(action.type) <span class="comment">// 传入的值</span></span><br><span class="line">  <span class="built_in">console</span>.log(action.payload) <span class="comment">// 接受的参数</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>一个vuex+vue-router的项目构架</p>
<p><img src="http://on7r0tqgu.bkt.clouddn.com/FtOzc0LclVcvmX62-7IVAvacI3Sh.png" alt=""></p>
</div></article></div></main><footer><div class="paginator"><a href="/2018/08/28/vue-MYCLI/" class="prev">上一篇</a><a href="/2018/08/24/回调函数的3种形式/" class="next">下一篇</a></div><div class="copyright"><p>© 2018 - 2020 <a href="http://yoursite.com">vkcyan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>